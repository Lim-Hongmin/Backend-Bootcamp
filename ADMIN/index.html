<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>회원가입</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style id="darkModeStylesheet">
        body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }
        .card.dark-mode {
            background-color: #1e1e1e;
            border-color: #444;
        }
        .form-control.dark-mode {
            background-color: #333;
            color: #e0e0e0;
            border-color: #555;
        }
        .form-control::placeholder {
            color: #aaaaaa;
        }
        .form-control.dark-mode::placeholder {
            color: #cccccc;
        }
        .btn-dark-mode {
            background-color: #6c757d;
            color: #e0e0e0;
            border: none;
        }
        label.dark-mode {
            color: #e0e0e0;
        }
        .form-text.dark-mode {
            color: #a0a0a0;
        }
        .card-title.dark-mode {
            color: #ffffff;
        }
        .password-strength-meter {
            height: 5px;
            background-color: #ddd;
            margin-top: 5px;
        }
        .password-strength-meter div {
            height: 100%;
            width: 0;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card" id="signupCard">
                    <div class="card-body">
                        <h3 class="card-title text-center mb-4" id="signupTitle">회원가입</h3>
                        <form id="signupForm">
                            <div class="mb-3">
                                <label for="username" class="form-label" id="usernameLabel">아이디</label>
                                <input type="text" class="form-control" id="username" placeholder="아이디" aria-label="아이디 입력">
                                <small class="form-text text-muted dark-mode" id="usernameHint">아이디는 5자 이상이어야 합니다.</small>
                                <div class="invalid-feedback">아이디를 입력하세요 (5자 이상).</div>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label" id="passwordLabel">비밀번호</label>
                                <input type="password" class="form-control" id="password" placeholder="비밀번호" aria-label="비밀번호 입력">
                                <small class="form-text text-muted dark-mode" id="passwordHint">영문 대소문자, 숫자, 특수문자를 포함한 8자 이상 30자 미만이어야 합니다.</small>
                                <div class="password-strength-meter"><div></div></div>
                                <div class="invalid-feedback">비밀번호는 영문 대소문자, 숫자, 특수문자를 포함한 8자 이상 30자 미만이어야 합니다.</div>
                            </div>
                            <div class="mb-3">
                                <label for="password-confirm" class="form-label" id="passwordConfirmLabel">비밀번호 확인</label>
                                <input type="password" class="form-control" id="password-confirm" placeholder="비밀번호 확인" aria-label="비밀번호 확인 입력">
                                <div class="invalid-feedback">비밀번호가 일치하지 않습니다.</div>
                            </div>
                            <div class="mb-3">
                                <label for="name" class="form-label" id="nameLabel">이름</label>
                                <input type="text" class="form-control" id="name" placeholder="사용자 이름" aria-label="이름 입력">
                                <div class="invalid-feedback">이름을 입력하세요.</div>
                            </div>
                            <div class="mb-3">
                                <label for="phone" class="form-label" id="phoneLabel">전화번호</label>
                                <input type="tel" class="form-control" id="phone" placeholder="전화번호" aria-label="전화번호 입력">
                                <div class="invalid-feedback">올바른 전화번호를 입력하세요.</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label" id="genderLabel">성별</label><br>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="gender" id="male" value="남자" aria-label="남자">
                                    <label class="form-check-label" for="male">남자</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="gender" id="female" value="여자" aria-label="여자">
                                    <label class="form-check-label" for="female">여자</label>
                                </div>
                                <div class="invalid-feedback">성별을 선택하세요.</div>
                            </div>
                            <div class="mb-3">
                                <label for="email" class="form-label" id="emailLabel">이메일</label>
                                <input type="email" class="form-control" id="email" placeholder="이메일" aria-label="이메일 입력">
                                <div class="invalid-feedback">올바른 이메일을 입력하세요.</div>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary">가입</button>
                            </div>
                        </form>
                        <div class="d-grid mt-3">
                            <button id="darkModeToggle" class="btn btn-secondary">다크 모드 전환</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 다크 모드 토글 기능
        const darkModeToggle = document.getElementById("darkModeToggle");
        const body = document.body;
        const signupCard = document.getElementById("signupCard");
        const signupTitle = document.getElementById("signupTitle");
        const formControls = document.querySelectorAll(".form-control");
        const labels = document.querySelectorAll("label");
        const hints = document.querySelectorAll(".form-text");

        function toggleDarkMode() {
            body.classList.toggle("dark-mode");
            signupCard.classList.toggle("dark-mode");
            signupTitle.classList.toggle("dark-mode");
            formControls.forEach(control => control.classList.toggle("dark-mode"));
            labels.forEach(label => label.classList.toggle("dark-mode"));
            hints.forEach(hint => hint.classList.toggle("dark-mode"));
            
            // 다크 모드 설정을 로컬 스토리지에 저장
            const isDarkMode = body.classList.contains("dark-mode");
            localStorage.setItem("darkMode", isDarkMode);
        }

        darkModeToggle.addEventListener("click", toggleDarkMode);

        // 페이지 로드 시 저장된 다크 모드 설정 적용
        document.addEventListener("DOMContentLoaded", () => {
            const savedDarkMode = localStorage.getItem("darkMode");
            if (savedDarkMode === "true") {
                toggleDarkMode();
            }
        });

        // 비밀번호 강도 측정 함수
        function measurePasswordStrength(password) {
            let strength = 0;
            if (password.length >= 8) strength += 1;
            if (password.match(/[a-z]+/)) strength += 1;
            if (password.match(/[A-Z]+/)) strength += 1;
            if (password.match(/[0-9]+/)) strength += 1;
            if (password.match(/[$@#&!]+/)) strength += 1;
            return strength;
        }

        // 비밀번호 강도 시각화
        const passwordInput = document.getElementById("password");
        const strengthMeter = document.querySelector(".password-strength-meter div");

        passwordInput.addEventListener("input", function() {
            const strength = measurePasswordStrength(this.value);
            const width = (strength / 5) * 100;
            strengthMeter.style.width = `${width}%`;
            
            if (strength <= 2) {
                strengthMeter.style.backgroundColor = "#ff4d4d";
            } else if (strength <= 4) {
                strengthMeter.style.backgroundColor = "#ffd633";
            } else {
                strengthMeter.style.backgroundColor = "#5cd65c";
            }
        });

        // 유효성 검사 및 폼 제출 처리
        document.getElementById("signupForm").addEventListener("submit", function(event) {
            event.preventDefault();
            
            let isValid = true;
            const username = document.getElementById("username");
            const password = document.getElementById("password");
            const passwordConfirm = document.getElementById("password-confirm");
            const name = document.getElementById("name");
            const phone = document.getElementById("phone");
            const gender = document.querySelector('input[name="gender"]:checked');
            const email = document.getElementById("email");

            // 유효성 검사 함수
            function validateField(field, condition, errorMessage) {
                if (!condition) {
                    field.classList.add("is-invalid");
                    field.nextElementSibling.textContent = errorMessage;
                    isValid = false;
                } else {
                    field.classList.remove("is-invalid");
                }
            }

            // 아이디 유효성 검사
            validateField(username, username.value.length >= 5, "아이디는 5자 이상이어야 합니다.");

            // 비밀번호 유효성 검사
            const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[$@#&!])[A-Za-z\d$@#&!]{8,30}$/;
            validateField(password, passwordRegex.test(password.value), "비밀번호는 영문 대소문자, 숫자, 특수문자를 포함한 8자 이상 30자 미만이어야 합니다.");

            // 비밀번호 확인 검사
            validateField(passwordConfirm, password.value === passwordConfirm.value, "비밀번호가 일치하지 않습니다.");

            // 이름 검사
            validateField(name, name.value.trim() !== "", "이름을 입력하세요.");

            // 전화번호 검사
            const phoneRegex = /^01[016789]-?[^0][0-9]{2,3}-?[0-9]{3,4}$/;
            validateField(phone, phoneRegex.test(phone.value), "올바른 전화번호를 입력하세요.");

            // 성별 검사
            if (!gender) {
                document.querySelector('.form-check-input').classList.add("is-invalid");
                isValid = false;
            } else {
                document.querySelector('.form-check-input').classList.remove("is-invalid");
            }

            // 이메일 검사
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            validateField(email, emailRegex.test(email.value), "올바른 이메일을 입력하세요.");

            // 유효성 검사 후 처리
            if (isValid) {
                // 회원가입 정보 알림창 표시
                alert(`회원가입이 완료되었습니다!\n\n아이디: ${username.value}\n이름: ${name.value}\n전화번호: ${phone.value}\n성별: ${gender.value}\n이메일: ${email.value}`);
                // 여기에 서버로 데이터를 전송하는 코드를 추가할 수 있습니다.
                // window.location.href = "welcome.html";
            }
        });
    </script>
</body>
</html>